#!/bin/sh -
#
# $Id: chk.proto 7 2007-02-03 13:34:17Z gburd $
#
# Check to make sure that prototypes are actually needed.

d=../..

[ -f $d/LICENSE ] || {
	echo 'FAIL: cannot find source distribution directory.'
	exit 1
}

t1=__1
t2=__2
t3=__3

egrep '__P' $d/src/inc/*.h |
    sed -e 's/[	 ][	 ]*__P.*//' \
    -e 's/^.*[	 *]//' \
    > $t1

find $d -name '*.in' -o -name '*.[ch]' -o -name '*.cpp' > $t2
for i in `cat $t1`; do
	c=$(egrep -Hlw $i $(cat $t2) | wc -l)
	echo "$i: $c"
done | egrep ' 1$' > $t3

test -s $t3 && {
	cat $t3
	echo "FAIL: found unnecessary prototypes."
	exit 1
}

exit 0
